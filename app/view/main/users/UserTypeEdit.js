Ext.define("MyApp.view.main.users.UserTypeEdit",{extend:"Ext.window.Window",xtype:"usertypeformwindow",reference:"popupWindow",itemId:"UserTypeEdit",bind:{title:"{title}"},title:"\u7f16\u8f91\u8d44\u6599",width:600,height:500,minWidth:200,minHeight:120,layout:"fit",closeAction:"destroy",bodyPadding:20,plain:true,modal:true,items:[{xtype:"form",reference:"windowForm",layout:{type:"hbox",align:"stretch"},bodyPadding:5,border:0,items:[{xtype:"panel",defaultType:"textfield",flex:1,border:0,fieldDefaults:{labelWidth:70,frame:true},layout:{type:"vbox",align:"stretch"},bodyPadding:5,border:false,items:[{fieldLabel:"E_code",name:"E_code",hidden:true,bind:"{E_code}"},{fieldLabel:"id",name:"id",hidden:true,bind:"{id}"},{xtype:"textarea",width:"90%",height:"auto",fieldLabel:"menustring",name:"menustring",hidden:true,bind:"{menustring}"},{fieldLabel:"\u4ee3\u7801",regex:/(^[0-9A-Z]{1,5}$)/,width:20,maxLength:5,allowBank:false,name:"code",bind:"{code}"},{fieldLabel:"\u540d\u79f0",allowBank:false,name:"typename",bind:"{typename}"},{xtype:"checkbox",fieldLabel:"\u65b0\u589e\u6743\u9650",name:"new",bind:"{new}"},{xtype:"checkbox",fieldLabel:"\u5220\u9664\u6743\u9650",name:"del",bind:"{del}"},{xtype:"checkbox",fieldLabel:"\u4ed3\u7ba1\u5ba1\u6838\u6743",name:"edit",bind:"{edit}"},{xtype:"checkbox",fieldLabel:"\u4e1a\u52a1\u5ba1\u6838\u6743",name:"sh",bind:"{sh}"},{xtype:"checkbox",fieldLabel:"\u8d22\u52a1\u5ba1\u6838\u6743",name:"cwsh",bind:"{cwsh}"}]},{xtype:"treepanel",title:"\u7cfb\u7edf\u6743\u9650\u8bbe\u7f6e",reference:"selectWorkerTreePanel",itemId:"selectWorkerTreePanel",singleExpand:false,rootVisible:false,draggable:false,useArrows:true,border:1,lines:true,flex:1,expanded:true,store:{itemId:"selectWorkerTreeStore",type:"tree",proxy:{type:"ajax",api:{read:sys_ActionPHP+"?act\x3dsystemmenutreelist"},actionMethods:{read:"GET"},extraParams:{userInfo:base64encode(Ext.encode(obj2str(sys_userInfo))),p_e_code:sys_enterprise_code,p_l_id:sys_location_id,displayall:sys_DisplayAll}},root:{text:"\u5168\u90e8",id:"ALL",code:"",checked:false,expanded:true,draggable:false},autoLoad:true,listeners:{load:function(store){var p=that.lookupReference("popupWindow").getViewModel();var str=p.get("menustring");if(str==undefined)str="";var tree=that.getView().down("#selectWorkerTreePanel");var nodes=tree.getRootNode().childNodes;for(var j=0;j<nodes.length;j++){var node=tree.getRootNode().childNodes[j];if(str.indexOf(";"+node.data.id+";")>-1)node.data.checked=true;if(node.hasChildNodes()){for(var i=0;i<node.childNodes.length;i++){var node1=node.childNodes[i];if(str.indexOf(";"+node1.data.id+";")>-1)node1.data.checked=true}node.expand(true,true)}}}}},listeners:{checkchange:function(node,checked){node.expand();node.checked=checked;node.eachChild(function(child){child.set("checked",checked);this.fireEvent("checkchange",child,checked)})}}}]}],buttons:[{text:"\u4fdd\u5b58",icon:"images/right.gif",handler:"onFormSubmit"},{text:"\u653e\u5f03",icon:"images/close.gif",handler:function(){this.up("window").close()}}]});